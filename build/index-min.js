KISSY.add('kg/curve/1.0.0/index',["node","base","./lib/util"],function(S ,require, exports, module) {var t=require("node"),e=require("base"),i=require("./lib/util"),a=t.all,r=e.extend({initializer:function(){this._initStage()},rotate:function(t){this.get("load")?this._load(t):this._rotate(t)},_initStage:function(){var t=this,e=a(t.get("item")),i=a(e[0]);t._itemH=i.outerHeight(),t._itemW=i.outerWidth();var r=t.get("perspective")+"px";t.get("container").css({"-webkit-perspective":r,perspective:r}),t.get("stage").css({height:t._itemH,width:t._itemW,margin:"0 auto",position:"relative","transform-style":"preserve-3d","-webkit-transition":"-webkit-transform 1s","-moz-transition":"-moz-transform 1s",transition:"transform 1s"}),t._initStageTransform(),t._initItemCatch(),S.each(e,function(e,i){var a=t.itemCatch[i].pos;t._rePositionItem(e,a)})},_initStageTransform:function(){var t=this,e=t.get("step"),r=a(t.get("item")),n=t.get("container").outerWidth()/2,s=i.getHypotenuse({o:t._itemW/2,d:e/2}),o=i.getDegree({o:n,r:s});t._H=i.getAdjacent({d:o,r:s});var m=o-e/2,h=e*r.length-(o+e/2);t.set("range",{min:Math.min(m,h),max:Math.max(m,h),visualRange:2*o,visualNum:2*o/e}),t._rotate(m)},_rotate:function(t){var e=this.get("range");t<e.min?t=e.min:t>e.max&&(t=e.max);var i="translateZ("+this._H+"px) rotateY("+t+"deg)";this.get("stage").css({"-ms-transform":i,"-webkit-transform":i,"-moz-transform":i,transform:i}),this.set("range",{cur:t})},_load:function(t){var e=this,i=this.get("range"),a=this.get("step"),r=0;t<i.min?(r=Math.ceil((i.min-t)/a),this.fire("load",{loadType:"prepend",num:r,callback:function(i){e._prependItems(i),e._rotate(t)}})):t>i.max?(r=Math.ceil((t-i.max)/a),this.fire("load",{loadType:"append",num:r,callback:function(i){e._appendItems(i),e._rotate(t)}})):this._rotate(t)},_prependItems:function(t){var e,i,r=this,n=a(t),s=r.get("range"),o=this.get("step");S.each(n,function(t){r._prependItemCatch([t]),e=r.itemCatch.first,i=r.itemCatch[e].pos,r._rePositionItem(t,i)}),r.get("stage").prepend(n);var m=n.length;r.set("range",{min:s.min-o*m})},_appendItems:function(t){var e,i,r=this,n=a(t),s=r.get("range"),o=this.get("step");S.each(n,function(t){r._appendItemCatch([t]),e=r.itemCatch.last,i=r.itemCatch[e].pos,r._rePositionItem(t,i)}),r.get("stage").append(n);var m=n.length;r.set("range",{max:s.max+o*m})},_rePositionItem:function(t,e){var i=0-e.d,r="translateZ("+e.z+"px)  rotateY("+i+"deg)";a(t).css({display:"block",position:"absolute",left:e.left+"px","-ms-transform-origin-x":"left","-webkit-transform-origin-x":"left","-moz-transform-origin-x":"left","transform-origin-x":"left","-ms-transform":r,"-moz-transform":r,"-webkit-transform":r,transform:r})},_initItemCatch:function(){var t=this,e=S.makeArray(a(t.get("item")));if(e.length){t.itemCatch={first:0,last:0};var r=i.getAdjacent({o:t._itemW/2,d:t.get("step")/2});t.itemCatch[0]={pos:{d:0,w:t._itemW,h:0,z:-r,left:0},el:e[0]},e.shift(),t._appendItemCatch(e)}},_appendItemCatch:function(t){for(var e=this.itemCatch.last,i=t.length,a=0;i>a;a++){var r=this.itemCatch[e+a].pos;this.itemCatch[e+a+1]={pos:this._getNextPos(r),el:t[a]}}this.itemCatch.last=e+i},_prependItemCatch:function(t){var e=this.itemCatch.first,i=t.length;t.reverse();for(var a=0;i>a;a++){var r=this.itemCatch[e+a].pos;this.itemCatch[e-a-1]={pos:this._getPrePos(r),el:t[a]}}this.itemCatch.first=e-i},_getNextPos:function(t){var e=t.d+this.get("step"),a=i.getAdjacent({r:this._itemW,d:e}),r=i.getOpposite({r:this._itemW,d:e});return{d:e,w:a,h:r,z:t.z+t.h,left:t.left+t.w}},_getPrePos:function(t){var e=t.d-this.get("step"),a=i.getAdjacent({r:this._itemW,d:e}),r=i.getOpposite({r:this._itemW,d:e});return{d:e,w:a,h:r,z:t.z-r,left:t.left-a}}},{ATTRS:{container:{value:".ks-curve",getter:function(t){return a(t)}},stage:{value:".ks-curve-stage",getter:function(t){return a(t)}},item:{value:".ks-curve-item"},perspective:{value:800},step:{value:5},load:{value:!1},range:{value:{},setter:function(t){var e=this.get("range");return S.mix(e,t),e}}}});module.exports=r;});KISSY.add('kg/curve/1.0.0/lib/util',[],function(S ,require, exports, module) {var t={getOpposite:function(t){return t.r?Math.round(t.r*Math.sin(t.d/180*Math.PI)*100)/100:t.a?Math.round(t.a*Math.tan(t.d/180*Math.PI)*100)/100:0},getAdjacent:function(t){return t.r?Math.round(t.r*Math.cos(t.d/180*Math.PI)*100)/100:t.o?Math.round(t.o/Math.tan(t.d/180*Math.PI)*100)/100:0},getHypotenuse:function(t){return t.o?Math.round(t.o/Math.sin(t.d/180*Math.PI)*100)/100:t.a?Math.round(t.a/Math.cos(t.d/180*Math.PI)*100)/100:0},getDegree:function(t){return t.o&&t.r?Math.round(180*Math.asin(t.o/t.r)/Math.PI*100)/100:0}};module.exports=t;});